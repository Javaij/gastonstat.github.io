<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  
  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Using tapply, ddply, and sqldf for the same task &middot; Gaston Sanchez
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/hyde.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-144-precomposed.png">
                                 <link rel="shortcut icon" href="/public/favicon.ico">
  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body>

    <div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <h1>
        <a href="/">
          Gaston Sanchez
        </a>
      </h1>
      <p class="lead"></p>
    </div>

    <nav class="sidebar-nav">
      <a class="sidebar-nav-item" href="/">Home</a>

      

      
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
            <a class="sidebar-nav-item" href="/blog/">Blog</a>
          
        
      
        
          
        
      
        
          
        
      
        
          
            <a class="sidebar-nav-item" href="/about/">About</a>
          
        
      
        
          
            <a class="sidebar-nav-item" href="/software/">Software</a>
          
        
      
        
          
            <a class="sidebar-nav-item" href="/teaching/">Teaching</a>
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      

      <a class="sidebar-nav-item" href="https://github.com/gastonstat" target="_blank">GitHub</a>
    </nav>

    <!-- <p><small>All contents under <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">(CC) BY-NC-SA</a> license, unless otherwise noted</small></p>
  -->
  </div>
</div>


    <div class="content container">
      <div class="post">
  <h1 class="post-title">Using tapply, ddply, and sqldf for the same task</h1>
  <span class="post-date">08 Jun 2012</span>
  <p>Usually there&#39;s more than one way to do things when programming with data. An interesting 
application is when we want to do some calculation on a quantitative variable that is 
associated to a qualitative variable. For instance, you have the prices (quantitative) 
and brands (qualitative) of different products, and you want to get the average price of 
those products by brand. To make things clearer let&#39;s generate some imaginary data of 
commercial products:</p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># here&#39;s the data</span>
item <span class="o">=</span> <span class="kp">toupper</span><span class="p">(</span><span class="kc">letters</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">15</span><span class="p">])</span>

<span class="kp">set.seed</span><span class="p">(</span><span class="m">321</span><span class="p">)</span>
brand <span class="o">=</span> <span class="kp">sample</span><span class="p">(</span><span class="kt">c</span><span class="p">(</span><span class="s">&quot;Alpha&quot;</span><span class="p">,</span> <span class="s">&quot;Beta&quot;</span><span class="p">),</span> <span class="kp">length</span><span class="p">(</span>item<span class="p">),</span> replace<span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span>
price <span class="o">=</span> <span class="kp">round</span><span class="p">(</span><span class="m">10</span> <span class="o">*</span> runif<span class="p">(</span><span class="kp">length</span><span class="p">(</span>item<span class="p">)),</span> <span class="m">2</span><span class="p">)</span>
units <span class="o">=</span> <span class="kp">sample</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">,</span> <span class="kp">length</span><span class="p">(</span>item<span class="p">),</span> replace<span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span>
some_data <span class="o">=</span> <span class="kt">data.frame</span><span class="p">(</span>item<span class="p">,</span> brand<span class="p">,</span> price<span class="p">,</span> <span class="kp">units</span><span class="p">)</span></code></pre></div>

<p>You should get a table like this one</p>

<div class="highlight"><pre><code class="language-r" data-lang="r">item   brand   price   <span class="kp">units</span>
<span class="m">1</span>       A    Beta    <span class="m">2.02</span>       <span class="m">1</span>
<span class="m">2</span>       B    Beta    <span class="m">6.33</span>       <span class="m">3</span>
<span class="m">3</span>       C   Alpha    <span class="m">4.04</span>       <span class="m">3</span>
<span class="m">4</span>       D   Alpha    <span class="m">2.91</span>       <span class="m">3</span>
<span class="m">5</span>       E   Alpha    <span class="m">6.40</span>       <span class="m">2</span>
<span class="m">6</span>       <span class="bp">F</span>   Alpha    <span class="m">6.36</span>       <span class="m">2</span>
<span class="m">7</span>       G   Alpha    <span class="m">9.90</span>       <span class="m">3</span>
<span class="m">8</span>       H   Alpha    <span class="m">9.31</span>       <span class="m">1</span>
<span class="m">9</span>       I   Alpha    <span class="m">4.86</span>       <span class="m">3</span>
<span class="m">10</span>      J    Beta    <span class="m">5.75</span>       <span class="m">2</span>
<span class="m">11</span>      K    Beta    <span class="m">7.51</span>       <span class="m">3</span>
<span class="m">12</span>      L   Alpha    <span class="m">9.93</span>       <span class="m">1</span>
<span class="m">13</span>      M    Beta    <span class="m">4.31</span>       <span class="m">2</span>
<span class="m">14</span>      N   Alpha    <span class="m">1.24</span>       <span class="m">3</span>
<span class="m">15</span>      O    Beta    <span class="m">5.94</span>       <span class="m">3</span></code></pre></div>

<p>How can we obtain the average price by brand? Well, it depends on what do you want to 
use. Here are some options:</p>

<ul>
<li>using a <code>for</code> loop (not recommendable)</li>
<li>using boolean selection</li>
<li>using <code>tapply()</code></li>
<li>using <code>ddply()</code> from package <code>&quot;plyr&quot;</code></li>
<li>using a sql query (with package <code>&quot;sqldf&quot;</code>)</li>
</ul>

<h3>Option 1: using a <em>for loop</em></h3>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># Naive option: don&#39;t do this!!!</span>
n_alpha <span class="o">=</span> <span class="m">0</span>
n_beta <span class="o">=</span> <span class="m">0</span>
avg_alpha <span class="o">=</span> <span class="m">0</span>
avg_beta <span class="o">=</span> <span class="m">0</span>
<span class="kr">for</span> <span class="p">(</span>i <span class="kr">in</span> <span class="m">1</span><span class="o">:</span><span class="kp">nrow</span><span class="p">(</span>some_data<span class="p">))</span> <span class="p">{</span>
    <span class="kr">if</span> <span class="p">(</span>some_data<span class="o">$</span>brand<span class="p">[</span>i<span class="p">]</span> <span class="o">==</span> <span class="s">&quot;Alpha&quot;</span><span class="p">)</span> <span class="p">{</span>
        avg_alpha <span class="o">=</span> avg_alpha <span class="o">+</span> some_data<span class="o">$</span>price<span class="p">[</span>i<span class="p">]</span>
        n_alpha <span class="o">=</span> n_alpha <span class="o">+</span> <span class="m">1</span>
    <span class="p">}</span> <span class="kr">else</span> <span class="p">{</span>
        avg_beta <span class="o">=</span> avg_beta <span class="o">+</span> some_data<span class="o">$</span>price<span class="p">[</span>i<span class="p">]</span>
        n_beta <span class="o">=</span> n_beta <span class="o">+</span> <span class="m">1</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="kp">cat</span><span class="p">(</span><span class="s">&quot;Average Alpha:&quot;</span><span class="p">,</span> avg_alpha <span class="o">/</span> n_alpha<span class="p">,</span>
<span class="s">&quot;\nAverage Beta:&quot;</span><span class="p">,</span> avg_beta <span class="o">/</span> n_beta<span class="p">)</span></code></pre></div>

<div class="highlight"><pre><code class="language-r" data-lang="r">Average Alpha<span class="o">:</span> <span class="m">6.105556</span>
Average Beta<span class="o">:</span> <span class="m">5.31</span></code></pre></div>

<h3>Option 2: using <em>boolean selection</em></h3>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># using boolean selection</span>
<span class="kp">with</span><span class="p">(</span>some_data<span class="p">,</span> <span class="kp">mean</span><span class="p">(</span>price<span class="p">[</span>brand<span class="o">==</span><span class="s">&quot;Alpha&quot;</span><span class="p">]))</span>
<span class="kp">with</span><span class="p">(</span>some_data<span class="p">,</span> <span class="kp">mean</span><span class="p">(</span>price<span class="p">[</span>brand<span class="o">==</span><span class="s">&quot;Beta&quot;</span><span class="p">]))</span></code></pre></div>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="m">6.105556</span>
<span class="m">5.31</span></code></pre></div>

<h3>Option 3: using <code>tapply()</code></h3>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># using tapply</span>
<span class="kp">with</span><span class="p">(</span>some_data<span class="p">,</span> <span class="kp">tapply</span><span class="p">(</span>price<span class="p">,</span> brand<span class="p">,</span> <span class="kp">mean</span><span class="p">))</span></code></pre></div>

<div class="highlight"><pre><code class="language-r" data-lang="r">Alpha Beta
<span class="m">6.105556</span> <span class="m">5.310000</span></code></pre></div>

<h3>Option 4: using <em>ddply</em></strong></h3>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># using ddply</span>
<span class="kn">require</span><span class="p">(</span>plyr<span class="p">)</span>
ddply<span class="p">(</span>some_data<span class="p">,</span> <span class="m">.</span><span class="p">(</span>brand<span class="p">),</span> summarise<span class="p">,</span> mean_price<span class="o">=</span><span class="kp">mean</span><span class="p">(</span>price<span class="p">))</span></code></pre></div>

<div class="highlight"><pre><code class="language-r" data-lang="r">brand mean_price
<span class="m">1</span> Alpha <span class="m">6.105556</span>
<span class="m">2</span> Beta <span class="m">5.310000</span></code></pre></div>

<h3>Option 5: using an <em>SQL query</em></h3>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># Using an SQL query</span>
<span class="kn">require</span><span class="p">(</span>sqldf<span class="p">)</span>
sqldf<span class="p">(</span><span class="s">&quot;SELECT brand, AVG(price) AS mean_price FROM some_data GROUP BY brand&quot;</span><span class="p">)</span></code></pre></div>

<div class="highlight"><pre><code class="language-r" data-lang="r">brand mean_price
<span class="m">1</span> Alpha <span class="m">6.105556</span>
<span class="m">2</span> Beta <span class="m">5.310000</span></code></pre></div>

</div>

<hr>

<div class="previous_next">
  
    <a href="/how-to/2012/06/01/How-to-read-files/" title="Previous post">&larr; previous</a>
  
  &nbsp;&nbsp;
  
    <a href="/how-to/2012/06/17/PCA-in-R/" title="Next post">next &rarr;</a>
  
  <br>
  <p>
  <a class="greenbutton" href="/blog/archive/" title="an archive of all posts">See all posts</a>
  </p>
</div>
    </div>

  </body>
</html>
