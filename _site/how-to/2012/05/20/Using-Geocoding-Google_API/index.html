<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  
  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Using Geocoding Google API &middot; Gaston Sanchez
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/hyde.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-144-precomposed.png">
                                 <link rel="shortcut icon" href="/public/favicon.ico">
  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body>

    <div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <h1>
        <a href="/">
          Gaston Sanchez
        </a>
      </h1>
      <p class="lead"></p>
    </div>

    <nav class="sidebar-nav">
      <a class="sidebar-nav-item" href="/">Home</a>

      

      
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
            <a class="sidebar-nav-item" href="/blog/">Blog</a>
          
        
      
        
          
        
      
        
          
        
      
        
          
            <a class="sidebar-nav-item" href="/about/">About</a>
          
        
      
        
          
            <a class="sidebar-nav-item" href="/software/">Software</a>
          
        
      
        
          
            <a class="sidebar-nav-item" href="/teaching/">Teaching</a>
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      

      <a class="sidebar-nav-item" href="https://github.com/gastonstat" target="_blank">GitHub</a>
    </nav>

    <!-- <p><small>All contents under <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">(CC) BY-NC-SA</a> license, unless otherwise noted</small></p>
  -->
  </div>
</div>


    <div class="content container">
      <div class="post">
  <h1 class="post-title">Using Geocoding Google API</h1>
  <span class="post-date">20 May 2012</span>
  <h3>Ever wanted to transform an address into longitude and latitude coordinates?</h3>

<!--more-->

<p>When working with data that can be projected to geographic places, there&#39;s nothing more 
tempting than trying to visualize it in a map. You just need a set of coordinates 
(longitude and latitude) and some map visualization tool. So far, so good. The problem 
arises when the only thing you have is addresses but no longitude and latitude. What can 
be done in such cases? Meet <a title="geocoding" href="http://en.wikipedia.org/wiki/Geocoding" target="_blank">Geocoding</a>!</p>

<p>According to wikipedia: </p>

<blockquote>
<p>geocoding is the process of finding associated geographic coordinates from other 
geographic data, such as street addresses or zip codes </p>
</blockquote>

<p>The idea is very simple. Let&#39;s say we have some address like 
<code>1600 Amphitheatre Parkway, Mountain View, CA</code>, and that we ant to get its geographic 
coordinates. By using a geocoding tool we would find that the previous address has 
latitude 37.423021 and longitude -122.083739.</p>

<h3>What can we use to <em>geocodify</em> our data in R?</h3>

<p>An interesting &mdash;but not the only&mdash; option is to use the Geocoding Google APIÂ from 
<a title="google maps api" href="https://developers.google.com/maps/documentation/webservices/" target="_blank">Google Maps API Web Services</a>.</p>

<p><a title="google maps api" href="https://developers.google.com/maps/documentation/webservices/" target="_blank">
<img class="centered" title="API_Geocoding" src="/images/blog/api_geocoding.png" />
</a></p>

<p>If you check the <a href="https://developers.google.com/maps/documentation/geocoding/" target="_blank">geocoding documentation</a>, 
you&#39;ll see that we can do requests and obtain the answers in XML format. The required url 
format that we would need is something like this:</p>

<div class="highlight"><pre><code class="language-text" data-lang="text">http://maps.googleapis.com/maps/api/geocode/xml?address=1600+Amphitheatre+Parkway,+Mountain+View,+CA&amp;amp;sensor=false</code></pre></div>

<h3>Code in R of a Geocoding API request with XML response</h3>

<p>In order to geocode some data in R we need to use the library <code>&quot;XML&quot;</code> (by 
Duncan Temple Lang). Here&#39;s a  &mdash;simple example &mdash; of how to do that:</p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># load package XML</span>
<span class="kn">library</span><span class="p">(</span>XML<span class="p">)</span>

<span class="c1"># Let&#39;s say we have a vector with 3 addresses</span>
address <span class="o">=</span> <span class="kt">c</span><span class="p">(</span>
  <span class="s">&quot;Newark Bl and Mayhews Landing Rd, Newark, CA&quot;</span><span class="p">,</span>
  <span class="s">&quot;Powell and North Point Dr, San Francisco, CA&quot;</span><span class="p">,</span>
  <span class="s">&quot;Sonoma Bl and Yolano Dr, Vallejo, CA&quot;</span>
<span class="p">)</span>

<span class="c1"># define geocoding google api url</span>
geo_url <span class="o">=</span> <span class="s">&quot;http://maps.googleapi.com/maps/api/geocode/xml?address=&quot;</span>

<span class="c1"># empty vectors to store latitude and longitude</span>
lat <span class="o">=</span> <span class="kp">rep</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="m">3</span><span class="p">)</span>
lon <span class="o">=</span> <span class="kp">rep</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="m">3</span><span class="p">)</span>

<span class="c1"># parsing</span>
<span class="kr">for</span> <span class="p">(</span>i <span class="kr">in</span> <span class="m">1</span><span class="o">:</span><span class="kp">length</span><span class="p">(</span>address<span class="p">))</span>
<span class="p">{</span>
  <span class="c1"># replace spaces by &#39;+&#39; symbols in current address</span>
  query <span class="o">=</span> <span class="kp">gsub</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">,</span> <span class="s">&quot;+&quot;</span><span class="p">,</span> address<span class="p">[</span>i<span class="p">])</span>
  
  <span class="c1"># create query</span>
  geo_query <span class="o">=</span> <span class="kp">paste</span><span class="p">(</span>geo_url<span class="p">,</span> query<span class="p">,</span> <span class="s">&quot;&amp;sensor=false&quot;</span><span class="p">,</span> sep<span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">)</span>
  doc <span class="o">=</span> htmlParse<span class="p">(</span>geo_query<span class="p">)</span>
  
  <span class="c1"># extract latitude and longitude</span>
  lat<span class="p">[</span>i<span class="p">]</span> <span class="o">=</span> xpathSApply<span class="p">(</span>doc<span class="p">,</span> <span class="s">&quot;//location/lat&quot;</span><span class="p">,</span> xmlValue<span class="p">)</span>
  lon<span class="p">[</span>i<span class="p">]</span> <span class="o">=</span> xpathSApply<span class="p">(</span>doc<span class="p">,</span> <span class="s">&quot;//location/lat&quot;</span><span class="p">,</span> xmlValue<span class="p">)</span>
<span class="p">}</span>

<span class="c1"># convert as numeric</span>
lat <span class="o">=</span> <span class="kp">as.numeric</span><span class="p">(</span>lat<span class="p">)</span>
lon <span class="o">=</span> <span class="kp">as.numeric</span><span class="p">(</span>lon<span class="p">)</span>

<span class="c1"># lat and lon in a matrix</span>
<span class="kp">cbind</span><span class="p">(</span>lat<span class="p">,</span> lon<span class="p">)</span></code></pre></div>

<p>The obtained results should be:</p>

<div class="highlight"><pre><code class="language-text" data-lang="text">lat = 37.5396808, 37.8068281, 38.1323594
lon = -122.0336495, -122.412118, -122.2561071</code></pre></div>

</div>

<hr>

<div class="previous_next">
  
    <a href="/crunching-data/how-to/visualization/2012/05/17/Visualizing-Bart-Fares-with-Networks/" title="Previous post">&larr; previous</a>
  
  &nbsp;&nbsp;
  
    <a href="/crunching-data/how-to/visualization/2012/05/25/Bart-Ridership/" title="Next post">next &rarr;</a>
  
  <br>
  <p>
  <a class="greenbutton" href="/blog/archive/" title="an archive of all posts">See all posts</a>
  </p>
</div>
    </div>

  </body>
</html>
