<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  
  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      5 functions to do Multiple Correspondence Analysis in R &middot; Gaston Sanchez
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/hyde.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-144-precomposed.png">
                                 <link rel="shortcut icon" href="/public/favicon.ico">
  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body>

    <div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <h1>
        <a href="/">
          Gaston Sanchez
        </a>
      </h1>
      <p class="lead"></p>
    </div>

    <nav class="sidebar-nav">
      <a class="sidebar-nav-item" href="/">Home</a>

      

      
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
            <a class="sidebar-nav-item" href="/blog/">Blog</a>
          
        
      
        
          
        
      
        
          
        
      
        
          
            <a class="sidebar-nav-item" href="/about/">About</a>
          
        
      
        
          
            <a class="sidebar-nav-item" href="/software/">Software</a>
          
        
      
        
          
            <a class="sidebar-nav-item" href="/teaching/">Teaching</a>
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      

      <a class="sidebar-nav-item" href="https://github.com/gastonstat" target="_blank">GitHub</a>
    </nav>

    <!-- <p><small>All contents under <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">(CC) BY-NC-SA</a> license, unless otherwise noted</small></p>
  -->
  </div>
</div>


    <div class="content container">
      <div class="post">
  <h1 class="post-title">5 functions to do Multiple Correspondence Analysis in R</h1>
  <span class="post-date">13 Oct 2012</span>
  <p>Today is the turn to talk about five different options of doing <strong>Multiple Correspondence Analysis</strong> in R (don&#39;t confuse it with Correspondence Analysis).</p>

<!--more-->

<p>Put in very simple terms, Multiple Correspondence Analysis (MCA) is to qualitative data, as Principal Component Analysis (PCA) is to quantitative data. Well, maybe I&#39;m oversimplifying a little bit because MCA has some special features that make it mathematically different from PCA, but they both share a lot of things in common from a data analysis standpoint. </p>

<p>As with PCA and Correspondence Analysis, MCA is just another tool in our kit of multivariate methods that allows us to analyze the systematic patterns of variations with categorical data. Keep in mind that MCA applies to tables in which the observations are described by a set of qualitative (i.e. categorical) variables. This means that in R you must have your table in the form of a data frame with factors (observations in the rows, qualitative variables in the columns).</p>

<h3>MCA in R</h3>

<p>In R, there are several functions from different packages that allow us to apply Multiple Correspondence Analysis. In this post I&#39;ll show you 5 different ways to perform MCA using the following functions (with their corresponding packages in parentheses):</p>

<ul>
<li><code>MCA()</code> (FactoMineR)</li>
<li><code>mca()</code> (MASS)</li>
<li><code>dudi.acm()</code> (ade4)</li>
<li><code>mjca()</code> (ca)</li>
<li><code>homals()</code> (homals)</li>
</ul>

<p>No matter what function you decide to use for MCA, the typical results should consist of a set of eigenvalues, a table with the row coordinates, and a table with the column coordinates. </p>

<p>Compared to the eigenvalues obtained from a PCA or a CA, the eigenvalues in a MCA can be much more smaller. This is important to know because if you just consider the eigenvalues, you might be tempted to conclude that MCA sucks. Which is absolutely false. </p>

<p>Personally, I think that the real meat and potatoes of MCA relies in its dimension reduction properties that let us visualize our data, among other things. Besides the eigenvalues, the row coordinates provide information about the structure of the rows in the analyzed table. In turn, the column coordinates provide information about the structure of the analyzed variables and their corresponding categories.</p>

<h3>The Data</h3>

<p>We&#39;ll use the dataset <code>tea</code> that comes in the R package <code>&quot;FactoMineR&quot;</code> . It&#39;s a data frame (of factors) containing the answers of a questionnaire on tea consumption for 300 individuals. Although the data contains 36 columns (i.e. variables), for demonstration purposes I will only consider the following columns:</p>

<ol>
<li>What kind of tea do you drink (black, green, flavored)</li>
<li>How do you drink it (alone, w/milk, w/lemon, other)</li>
<li>What kind of presentation do you buy (tea bags, loose tea, both)</li>
<li>Do you add sugar (yes, no)</li>
<li>Where do you buy it (supermarket, shops, both)</li>
<li>Do you always drink tea (always, not always)</li>
</ol>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># load packages</span>
<span class="kn">require</span><span class="p">(</span>FactoMineR<span class="p">)</span>
<span class="kn">require</span><span class="p">(</span>ggplot2<span class="p">)</span>

<span class="c1"># load data tea</span>
data<span class="p">(</span>tea<span class="p">)</span>

<span class="c1"># select these columns</span>
newtea <span class="o">=</span> tea<span class="p">[,</span> <span class="kt">c</span><span class="p">(</span><span class="s">&quot;Tea&quot;</span><span class="p">,</span> <span class="s">&quot;How&quot;</span><span class="p">,</span> <span class="s">&quot;how&quot;</span><span class="p">,</span> <span class="s">&quot;sugar&quot;</span><span class="p">,</span> <span class="s">&quot;where&quot;</span><span class="p">,</span> <span class="s">&quot;always&quot;</span><span class="p">)]</span>

<span class="c1"># take a peek</span>
<span class="kp">head</span><span class="p">(</span>newtea<span class="p">)</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">##         Tea   How     how    sugar       where     always
## 1     black alone tea bag    sugar chain store Not.always
## 2     black  milk tea bag No.sugar chain store Not.always
## 3 Earl Grey alone tea bag No.sugar chain store Not.always
## 4 Earl Grey alone tea bag    sugar chain store Not.always
## 5 Earl Grey alone tea bag No.sugar chain store     always
## 6 Earl Grey alone tea bag No.sugar chain store Not.always</code></pre></div>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># number of categories per variable</span>
cats <span class="o">=</span> <span class="kp">apply</span><span class="p">(</span>newtea<span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="kr">function</span><span class="p">(</span>x<span class="p">)</span> <span class="kp">nlevels</span><span class="p">(</span><span class="kp">as.factor</span><span class="p">(</span>x<span class="p">)))</span>

cats</code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">##    Tea    How    how  sugar  where always 
##      3      4      3      2      3      2</code></pre></div>

<h3>Option 1: using MCA()</h3>

<p>My preferred function to do multiple correspondence analysis is the <code>MCA()</code> function that comes in the fabulous package <code>&quot;FactoMineR&quot;</code> by Francois Husson, Julie Josse, Sebastien Le, and Jeremy Mazet. If you have seen my other posts you&#39;ll know that this is one of favorite packages and I strongly recommend other users to seriously take a look at it. It provides the most complete list of results with different calculations for interpretation and diagnosis.</p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># apply MCA</span>
mca1 <span class="o">=</span> MCA<span class="p">(</span>newtea<span class="p">,</span> graph <span class="o">=</span> <span class="kc">FALSE</span><span class="p">)</span>

<span class="c1"># list of results</span>
mca1</code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">## **Results of the Multiple Correspondence Analysis (MCA)**
## The analysis was performed on 300 individuals, described by 6 variables
## *The results are available in the following objects:
## 
##    name              description                       
## 1  &quot;$eig&quot;            &quot;eigenvalues&quot;                     
## 2  &quot;$var&quot;            &quot;results for the variables&quot;       
## 3  &quot;$var$coord&quot;      &quot;coord. of the categories&quot;        
## 4  &quot;$var$cos2&quot;       &quot;cos2 for the categories&quot;         
## 5  &quot;$var$contrib&quot;    &quot;contributions of the categories&quot; 
## 6  &quot;$var$v.test&quot;     &quot;v-test for the categories&quot;       
## 7  &quot;$ind&quot;            &quot;results for the individuals&quot;     
## 8  &quot;$ind$coord&quot;      &quot;coord. for the individuals&quot;      
## 9  &quot;$ind$cos2&quot;       &quot;cos2 for the individuals&quot;        
## 10 &quot;$ind$contrib&quot;    &quot;contributions of the individuals&quot;
## 11 &quot;$call&quot;           &quot;intermediate results&quot;            
## 12 &quot;$call$marge.col&quot; &quot;weights of columns&quot;              
## 13 &quot;$call$marge.li&quot;  &quot;weights of rows&quot;</code></pre></div>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># table of eigenvalues</span>
mca1<span class="o">$</span>eig</code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">##        eigenvalue percentage of variance cumulative percentage of variance
## dim 1     0.27976                 15.260                             15.26
## dim 2     0.25775                 14.059                             29.32
## dim 3     0.22014                 12.008                             41.33
## dim 4     0.18793                 10.251                             51.58
## dim 5     0.16876                  9.205                             60.78
## dim 6     0.16369                  8.928                             69.71
## dim 7     0.15289                  8.339                             78.05
## dim 8     0.13839                  7.548                             85.60
## dim 9     0.11569                  6.310                             91.91
## dim 10    0.08613                  4.698                             96.61
## dim 11    0.06221                  3.393                            100.00</code></pre></div>

<p>We can use the package <code>&quot;ggplot2()&quot;</code> to get a nice plot:</p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># data frame with variable coordinates</span>
mca1_vars_df <span class="o">=</span> <span class="kt">data.frame</span><span class="p">(</span>mca1<span class="o">$</span>var<span class="o">$</span>coord<span class="p">,</span> Variable <span class="o">=</span> <span class="kp">rep</span><span class="p">(</span><span class="kp">names</span><span class="p">(</span>cats<span class="p">),</span> cats<span class="p">))</span>

<span class="c1"># data frame with observation coordinates</span>
mca1_obs_df <span class="o">=</span> <span class="kt">data.frame</span><span class="p">(</span>mca1<span class="o">$</span>ind<span class="o">$</span>coord<span class="p">)</span>

<span class="c1"># plot of variable categories</span>
ggplot<span class="p">(</span>data<span class="o">=</span>mca1_vars_df<span class="p">,</span> 
       aes<span class="p">(</span>x <span class="o">=</span> Dim.1<span class="p">,</span> y <span class="o">=</span> Dim.2<span class="p">,</span> label <span class="o">=</span> <span class="kp">rownames</span><span class="p">(</span>mca1_vars_df<span class="p">)))</span> <span class="o">+</span>
 geom_hline<span class="p">(</span>yintercept <span class="o">=</span> <span class="m">0</span><span class="p">,</span> colour <span class="o">=</span> <span class="s">&quot;gray70&quot;</span><span class="p">)</span> <span class="o">+</span>
 geom_vline<span class="p">(</span>xintercept <span class="o">=</span> <span class="m">0</span><span class="p">,</span> colour <span class="o">=</span> <span class="s">&quot;gray70&quot;</span><span class="p">)</span> <span class="o">+</span>
 geom_text<span class="p">(</span>aes<span class="p">(</span>colour<span class="o">=</span>Variable<span class="p">))</span> <span class="o">+</span>
 ggtitle<span class="p">(</span><span class="s">&quot;MCA plot of variables using R package FactoMineR&quot;</span><span class="p">)</span></code></pre></div>

<p><img src="/figs/2012-10-13-MCA-in-R/fig1.png" alt="center"> </p>

<p>In order to have a more interesting representation, we could superimpose a graphic display of both the observations and the categories. Moreover, since some individuals will be overlapped, we can add some density curves with <code>geom_density2d()</code> to see those zones that are highly concentrated:</p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># MCA plot of observations and categories</span>
ggplot<span class="p">(</span>data <span class="o">=</span> mca1_obs_df<span class="p">,</span> aes<span class="p">(</span>x <span class="o">=</span> Dim.1<span class="p">,</span> y <span class="o">=</span> Dim.2<span class="p">))</span> <span class="o">+</span>
  geom_hline<span class="p">(</span>yintercept <span class="o">=</span> <span class="m">0</span><span class="p">,</span> colour <span class="o">=</span> <span class="s">&quot;gray70&quot;</span><span class="p">)</span> <span class="o">+</span>
  geom_vline<span class="p">(</span>xintercept <span class="o">=</span> <span class="m">0</span><span class="p">,</span> colour <span class="o">=</span> <span class="s">&quot;gray70&quot;</span><span class="p">)</span> <span class="o">+</span>
  geom_point<span class="p">(</span>colour <span class="o">=</span> <span class="s">&quot;gray50&quot;</span><span class="p">,</span> alpha <span class="o">=</span> <span class="m">0.7</span><span class="p">)</span> <span class="o">+</span>
  geom_density2d<span class="p">(</span>colour <span class="o">=</span> <span class="s">&quot;gray80&quot;</span><span class="p">)</span> <span class="o">+</span>
  geom_text<span class="p">(</span>data <span class="o">=</span> mca1_vars_df<span class="p">,</span> 
            aes<span class="p">(</span>x <span class="o">=</span> Dim.1<span class="p">,</span> y <span class="o">=</span> Dim.2<span class="p">,</span> 
                label <span class="o">=</span> <span class="kp">rownames</span><span class="p">(</span>mca1_vars_df<span class="p">),</span> colour <span class="o">=</span> Variable<span class="p">))</span> <span class="o">+</span>
  ggtitle<span class="p">(</span><span class="s">&quot;MCA plot of variables using R package FactoMineR&quot;</span><span class="p">)</span> <span class="o">+</span>
  scale_colour_discrete<span class="p">(</span>name <span class="o">=</span> <span class="s">&quot;Variable&quot;</span><span class="p">)</span></code></pre></div>

<p><img src="/figs/2012-10-13-MCA-in-R/fig2.png" alt="center"> </p>

<h3>Option 2: using mca()</h3>

<p>Another function for performing MCA is the <code>mca()</code> function that comes in the <code>&quot;MASS&quot;</code> package by Brian Ripley <em>et al</em>.</p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># load MASS</span>
<span class="kn">require</span><span class="p">(</span>MASS<span class="p">)</span>

<span class="c1"># apply mca</span>
mca2 <span class="o">=</span> mca<span class="p">(</span>newtea<span class="p">,</span> nf <span class="o">=</span> <span class="m">5</span><span class="p">)</span>

<span class="c1"># eigenvalues</span>
mca2<span class="o">$</span>d<span class="o">^</span><span class="m">2</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">## [1] 0.2798 0.2577 0.2201 0.1879 0.1688</code></pre></div>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># column coordinates</span>
<span class="kp">head</span><span class="p">(</span>mca2<span class="o">$</span>cs<span class="p">)</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">##                        1         2         3        4         5
## Tea.black     -0.0081111  0.002719 -0.023118  0.01638  0.004040
## Tea.Earl Grey  0.0045538  0.002113  0.009848 -0.00155 -0.001838
## Tea.green     -0.0084442 -0.018452 -0.005754 -0.02766  0.001690
## How.alone      0.0003982 -0.004760 -0.002118 -0.01015 -0.005462
## How.lemon     -0.0124132  0.008793  0.025995  0.02224 -0.027419
## How.milk       0.0060215  0.004332 -0.001424  0.01422  0.031530</code></pre></div>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># row coordiantes</span>
<span class="kp">head</span><span class="p">(</span>mca2<span class="o">$</span>rs<span class="p">)</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">##          1         2         3          4         5
## 1 0.003145 -0.002793 -0.003668  0.0039064 -0.002256
## 2 0.002590 -0.001019 -0.007695  0.0053562  0.004107
## 3 0.003764 -0.002635 -0.002316 -0.0016939 -0.003038
## 4 0.005256 -0.002894  0.001827  0.0009183 -0.003235
## 5 0.003259 -0.002069  0.000312 -0.0036093  0.002301
## 6 0.003764 -0.002635 -0.002316 -0.0016939 -0.003038</code></pre></div>

<p>We can get an MCA plot of variables:</p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># data frame for ggplot</span>
mca2_vars_df <span class="o">=</span> <span class="kt">data.frame</span><span class="p">(</span>mca2<span class="o">$</span>cs<span class="p">,</span> Variable <span class="o">=</span> <span class="kp">rep</span><span class="p">(</span><span class="kp">names</span><span class="p">(</span>cats<span class="p">),</span> cats<span class="p">))</span>

<span class="c1"># plot</span>
ggplot<span class="p">(</span>data <span class="o">=</span> mca2_vars_df<span class="p">,</span> 
       aes<span class="p">(</span>x <span class="o">=</span> X1<span class="p">,</span> y <span class="o">=</span> X2<span class="p">,</span> label <span class="o">=</span> <span class="kp">rownames</span><span class="p">(</span>mca2_vars_df<span class="p">)))</span> <span class="o">+</span>
  geom_hline<span class="p">(</span>yintercept <span class="o">=</span> <span class="m">0</span><span class="p">,</span> colour <span class="o">=</span> <span class="s">&quot;gray70&quot;</span><span class="p">)</span> <span class="o">+</span>
  geom_vline<span class="p">(</span>xintercept <span class="o">=</span> <span class="m">0</span><span class="p">,</span> colour <span class="o">=</span> <span class="s">&quot;gray70&quot;</span><span class="p">)</span> <span class="o">+</span>
  geom_text<span class="p">(</span>aes<span class="p">(</span>colour <span class="o">=</span> Variable<span class="p">))</span> <span class="o">+</span>
  ggtitle<span class="p">(</span><span class="s">&quot;MCA plot of variables using R package MASS&quot;</span><span class="p">)</span></code></pre></div>

<p><img src="/figs/2012-10-13-MCA-in-R/fig3.png" alt="center"> </p>

<p>If you prefer not to use <code>&quot;ggplot2&quot;</code>, you can stay with the default plots (not for me)</p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># default biplot in MASS (kind of ugly)</span>
plot<span class="p">(</span>mca2<span class="p">)</span></code></pre></div>

<p><img src="/figs/2012-10-13-MCA-in-R/fig4.png" alt="center"> </p>

<h3>Option 3: using dudi.acm()</h3>

<p>A third option to perform MCA is by using the function <code>dudi.acm()</code> that comes with the package <code>&quot;ade4&quot;</code> by Simon Penel <em>et al</em> (remember to install the package first).</p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># MCA with function dudi.acm</span>
<span class="kn">require</span><span class="p">(</span>ade4<span class="p">)</span>

<span class="c1"># apply dudi.acm</span>
mca3 <span class="o">=</span> dudi.acm<span class="p">(</span>newtea<span class="p">,</span> scannf <span class="o">=</span> <span class="kc">FALSE</span><span class="p">,</span> nf <span class="o">=</span> <span class="m">5</span><span class="p">)</span>

<span class="c1"># eigenvalues</span>
mca3<span class="o">$</span>eig</code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">##  [1] 0.27976 0.25775 0.22014 0.18793 0.16876 0.16369 0.15289 0.13839
##  [9] 0.11569 0.08613 0.06221</code></pre></div>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># column coordinates</span>
<span class="kp">head</span><span class="p">(</span>mca3<span class="o">$</span>co<span class="p">)</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">##                  Comp1   Comp2    Comp3    Comp4    Comp5
## Tea.black     -0.44585  0.1434  1.12722 -0.73788  0.17249
## Tea.Earl.Grey  0.25031  0.1115 -0.48017  0.06983 -0.07847
## Tea.green     -0.46416 -0.9735  0.28058  1.24626  0.07214
## How.alone      0.02189 -0.2511  0.10326  0.45737 -0.23317
## How.lemon     -0.68232  0.4639 -1.26750 -1.00191 -1.17060
## How.milk       0.33099  0.2286  0.06944 -0.64061  1.34609</code></pre></div>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># row coordinates</span>
<span class="kp">head</span><span class="p">(</span>mca3<span class="o">$</span>li<span class="p">)</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">##    Axis1   Axis2    Axis3    Axis4   Axis5
## 1 0.3269 -0.2902  0.38114 -0.40596 -0.2344
## 2 0.2692 -0.1059  0.79969 -0.55663  0.4269
## 3 0.3911 -0.2739  0.24072  0.17603 -0.3157
## 4 0.5462 -0.3007 -0.18984 -0.09543 -0.3362
## 5 0.3387 -0.2150 -0.03242  0.37509  0.2391
## 6 0.3911 -0.2739  0.24072  0.17603 -0.3157</code></pre></div>

<p>Here&#39;s how to get the MCA plot of variables with <code>ggplot()</code></p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># data frame for ggplot</span>
mca3_vars_df <span class="o">=</span> <span class="kt">data.frame</span><span class="p">(</span>mca3<span class="o">$</span>co<span class="p">,</span> Variable <span class="o">=</span> <span class="kp">rep</span><span class="p">(</span><span class="kp">names</span><span class="p">(</span>cats<span class="p">),</span> cats<span class="p">))</span>

<span class="c1"># plot</span>
ggplot<span class="p">(</span>data <span class="o">=</span> mca3_vars_df<span class="p">,</span> 
       aes<span class="p">(</span>x <span class="o">=</span> Comp1<span class="p">,</span> y <span class="o">=</span> Comp2<span class="p">,</span> label <span class="o">=</span> <span class="kp">rownames</span><span class="p">(</span>mca3_vars_df<span class="p">)))</span> <span class="o">+</span>
  geom_hline<span class="p">(</span>yintercept <span class="o">=</span> <span class="m">0</span><span class="p">,</span> colour <span class="o">=</span> <span class="s">&quot;gray70&quot;</span><span class="p">)</span> <span class="o">+</span>
  geom_vline<span class="p">(</span>xintercept <span class="o">=</span> <span class="m">0</span><span class="p">,</span> colour <span class="o">=</span> <span class="s">&quot;gray70&quot;</span><span class="p">)</span> <span class="o">+</span>
  geom_text<span class="p">(</span>aes<span class="p">(</span>colour <span class="o">=</span> Variable<span class="p">))</span> <span class="o">+</span>
  ggtitle<span class="p">(</span><span class="s">&quot;MCA plot of variables using R package ade4&quot;</span><span class="p">)</span></code></pre></div>

<p><img src="/figs/2012-10-13-MCA-in-R/fig5.png" alt="center"> </p>

<h3>Option 4: using mjca()</h3>

<p>Another interesting way for carrying out MCA is by using the function <code>mjca()</code> from the package <code>&quot;ca&quot;</code> by Michael Greenacre and Oleg Nenadic.</p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># PCA with function mjca</span>
<span class="kn">require</span><span class="p">(</span>ca<span class="p">)</span>

<span class="c1"># apply mjca</span>
mca4 <span class="o">=</span> mjca<span class="p">(</span>newtea<span class="p">,</span> lambda <span class="o">=</span> <span class="s">&quot;indicator&quot;</span><span class="p">,</span> nd <span class="o">=</span> <span class="m">5</span><span class="p">)</span>

<span class="c1"># eigenvalues</span>
mca4<span class="o">$</span>sv<span class="o">^</span><span class="m">2</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">##  [1] 0.27976 0.25775 0.22014 0.18793 0.16876 0.16369 0.15289 0.13839
##  [9] 0.11569 0.08613 0.06221</code></pre></div>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># column coordinates</span>
<span class="kp">head</span><span class="p">(</span>mca4<span class="o">$</span>colcoord<span class="p">)</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">##          [,1]    [,2]    [,3]    [,4]    [,5]    [,6]    [,7]    [,8]
## [1,] -0.84293  0.2825  2.4025 -1.7021  0.4199 -0.3094 -0.7239  0.6186
## [2,]  0.47324  0.2195 -1.0234  0.1611 -0.1910 -0.4697 -0.4730 -0.3718
## [3,] -0.87755 -1.9175  0.5980  2.8748  0.1756  3.4406  4.3895  0.7871
## [4,]  0.04138 -0.4947  0.2201  1.0550 -0.5676 -0.8043 -0.2693 -0.5657
## [5,] -1.29002  0.9138 -2.7015 -2.3112 -2.8495  1.2491  0.1538  4.7051
## [6,]  0.62577  0.4502  0.1480 -1.4777  3.2767  2.6284 -0.5791 -0.5741
##         [,9]    [,10]   [,11]
## [1,]  2.6024  0.17604  0.9394
## [2,] -1.0592 -0.38620 -0.3016
## [3,]  0.3589  1.86396 -0.3425
## [4,]  0.4204  0.23138  0.4805
## [5,]  0.4171  0.08123 -1.1769
## [6,] -0.9544 -0.48444 -0.5622</code></pre></div>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># row coordinates</span>
<span class="kp">head</span><span class="p">(</span>mca4<span class="o">$</span>rowcoord<span class="p">)</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">##        [,1]    [,2]    [,3]    [,4]    [,5]    [,6]     [,7]    [,8]
## [1,] 0.6180 -0.5717  0.8123 -0.9365 -0.5706 -0.2387 -0.06383 -0.3996
## [2,] 0.5089 -0.2085  1.7044 -1.2840  1.0391  1.1337 -0.87521  0.5964
## [3,] 0.7395 -0.5394  0.5131  0.4061 -0.7684 -0.3465 -0.63620  0.1565
## [4,] 1.0327 -0.5923 -0.4046 -0.2201 -0.8185 -0.3048  0.04315 -0.8433
## [5,] 0.6403 -0.4235 -0.0691  0.8653  0.5820 -1.3092 -0.42242  1.0691
## [6,] 0.7395 -0.5394  0.5131  0.4061 -0.7684 -0.3465 -0.63620  0.1565
##          [,9]    [,10]     [,11]
## [1,]  1.87979  0.25331  1.153553
## [2,]  0.01721 -0.30176  0.086183
## [3,] -1.10331 -0.21454 -0.046316
## [4,]  0.08561 -0.06599  0.324294
## [5,] -0.65316  0.18058  0.006424
## [6,] -1.10331 -0.21454 -0.046316</code></pre></div>

<p>We&#39;ll use the column coordinates <code>colcoord</code> to make a data frame and pass it to <code>ggplot()</code>:</p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># data frame for ggplot</span>
mca4_vars_df <span class="o">=</span> <span class="kt">data.frame</span><span class="p">(</span>mca4<span class="o">$</span>colcoord<span class="p">,</span> Variable <span class="o">=</span> <span class="kp">rep</span><span class="p">(</span><span class="kp">names</span><span class="p">(</span>cats<span class="p">),</span> cats<span class="p">))</span>
<span class="kp">rownames</span><span class="p">(</span>mca4_vars_df<span class="p">)</span> <span class="o">=</span> mca4<span class="o">$</span>levelnames

<span class="c1"># plot</span>
ggplot<span class="p">(</span>data <span class="o">=</span> mca4_vars_df<span class="p">,</span> 
       aes<span class="p">(</span>x <span class="o">=</span> X1<span class="p">,</span> y <span class="o">=</span> X2<span class="p">,</span> label <span class="o">=</span> <span class="kp">rownames</span><span class="p">(</span>mca4_vars_df<span class="p">)))</span> <span class="o">+</span>
  geom_hline<span class="p">(</span>yintercept <span class="o">=</span> <span class="m">0</span><span class="p">,</span> colour <span class="o">=</span> <span class="s">&quot;gray70&quot;</span><span class="p">)</span> <span class="o">+</span>
  geom_vline<span class="p">(</span>xintercept <span class="o">=</span> <span class="m">0</span><span class="p">,</span> colour <span class="o">=</span> <span class="s">&quot;gray70&quot;</span><span class="p">)</span> <span class="o">+</span>
  geom_text<span class="p">(</span>aes<span class="p">(</span>colour <span class="o">=</span> Variable<span class="p">))</span> <span class="o">+</span>
  ggtitle<span class="p">(</span><span class="s">&quot;MCA plot of variables using R package ca&quot;</span><span class="p">)</span></code></pre></div>

<p><img src="/figs/2012-10-13-MCA-in-R/fig6.png" alt="center"> </p>

<h3>Option 5: using homals()</h3>

<p>A fifth possibility is the <code>homals()</code> function from the package <code>&quot;homals&quot;</code> by Jan de Leeuw and Patrick Mair.</p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># CA with function corresp</span>
<span class="kn">require</span><span class="p">(</span>homals<span class="p">)</span>

<span class="c1"># apply homals</span>
mca5 <span class="o">=</span> homals<span class="p">(</span>newtea<span class="p">,</span> ndim <span class="o">=</span> <span class="m">5</span><span class="p">,</span> level <span class="o">=</span> <span class="s">&quot;nominal&quot;</span><span class="p">)</span>

<span class="c1"># eigenvalues</span>
mca5<span class="o">$</span>eigenvalues</code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">## [1] 0.02331 0.02148 0.01834 0.01566 0.01405</code></pre></div>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># column coordinates</span>
mca5<span class="o">$</span>catscores</code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">## $Tea
##                  D1        D2        D3        D4        D5
## black      0.010507  0.003388 -0.026569 -0.017393 -0.003410
## Earl Grey -0.005902  0.002623  0.011318  0.001646  0.002682
## green      0.010955 -0.022939 -0.006613  0.029374 -0.008038
## 
## $How
##               D1        D2        D3       D4        D5
## alone -0.0005122 -0.005920 -0.002434  0.01078  0.006872
## lemon  0.0160756  0.010945  0.029875 -0.02361  0.024779
## milk  -0.0078048  0.005382 -0.001637 -0.01511 -0.035961
## other  0.0067866  0.050458 -0.045354 -0.04129  0.011981
## 
## $how
##                           D1        D2        D3        D4         D5
## tea bag            -0.014523 -0.007774 -0.001527 -0.005628  0.0005400
## tea bag+unpackaged  0.008722  0.023588  0.001330  0.015138 -0.0002901
## unpackaged          0.045806 -0.024877  0.003735 -0.012950 -0.0017924
## 
## $sugar
##                 D1         D2       D3        D4         D5
## No.sugar  0.005606  0.0009363 -0.01381  0.008044 -0.0004736
## sugar    -0.005993 -0.0010009  0.01476 -0.008599  0.0005063
## 
## $where
##                            D1        D2        D3         D4         D5
## chain store          -0.01257 -0.008094 -0.003299  0.0001402  0.0005466
## chain store+tea shop  0.01131  0.031415  0.003057  0.0024093  0.0009563
## tea shop              0.05103 -0.029878  0.013167 -0.0071612 -0.0059849
## 
## $always
##                   D1        D2        D3        D4        D5
## always      0.002574  0.002777  0.011901  0.008008 -0.017946
## Not.always -0.001346 -0.001452 -0.006222 -0.004187  0.009383</code></pre></div>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># row coordinates</span>
<span class="kp">head</span><span class="p">(</span>mca5<span class="o">$</span>objscores<span class="p">)</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">##         D1        D2        D3        D4        D5
## 1 -0.01456 -0.013483 -0.019147 -0.022069  0.014290
## 2 -0.01199 -0.004923 -0.040173 -0.030272 -0.029165
## 3 -0.01742 -0.012725 -0.012093  0.009576  0.019355
## 4 -0.02433 -0.013977  0.009537 -0.005183  0.020316
## 5 -0.01509 -0.009991  0.001629  0.020390 -0.007502
## 6 -0.01742 -0.012725 -0.012093  0.009576  0.019355</code></pre></div>

<p>In order to get the MCA plot of variables, we first need to unlist the coordinates of the categories before creating the data frames for <code>ggplot()</code>:</p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># data frame for ggplot</span>
D1 <span class="o">=</span> <span class="kp">unlist</span><span class="p">(</span><span class="kp">lapply</span><span class="p">(</span>mca5<span class="o">$</span>catscores<span class="p">,</span> <span class="kr">function</span><span class="p">(</span>x<span class="p">)</span> x<span class="p">[,</span><span class="m">1</span><span class="p">]))</span>
D2 <span class="o">=</span> <span class="kp">unlist</span><span class="p">(</span><span class="kp">lapply</span><span class="p">(</span>mca5<span class="o">$</span>catscores<span class="p">,</span> <span class="kr">function</span><span class="p">(</span>x<span class="p">)</span> x<span class="p">[,</span><span class="m">2</span><span class="p">]))</span>

mca5_vars_df <span class="o">=</span> <span class="kt">data.frame</span><span class="p">(</span>D1 <span class="o">=</span> D1<span class="p">,</span> D2 <span class="o">=</span> D2<span class="p">,</span> Variable <span class="o">=</span> <span class="kp">rep</span><span class="p">(</span><span class="kp">names</span><span class="p">(</span>cats<span class="p">),</span> cats<span class="p">))</span>
<span class="kp">rownames</span><span class="p">(</span>mca5_vars_df<span class="p">)</span> <span class="o">=</span> <span class="kp">unlist</span><span class="p">(</span><span class="kp">sapply</span><span class="p">(</span>mca5<span class="o">$</span>catscores<span class="p">,</span> <span class="kr">function</span><span class="p">(</span>x<span class="p">)</span> <span class="kp">rownames</span><span class="p">(</span>x<span class="p">)))</span>

<span class="c1"># plot</span>
ggplot<span class="p">(</span>data <span class="o">=</span> mca5_vars_df<span class="p">,</span> 
       aes<span class="p">(</span>x <span class="o">=</span> D1<span class="p">,</span> y <span class="o">=</span> D2<span class="p">,</span> label <span class="o">=</span> <span class="kp">rownames</span><span class="p">(</span>mca5_vars_df<span class="p">)))</span> <span class="o">+</span>
  geom_hline<span class="p">(</span>yintercept <span class="o">=</span> <span class="m">0</span><span class="p">,</span> colour <span class="o">=</span> <span class="s">&quot;gray70&quot;</span><span class="p">)</span> <span class="o">+</span>
  geom_vline<span class="p">(</span>xintercept <span class="o">=</span> <span class="m">0</span><span class="p">,</span> colour <span class="o">=</span> <span class="s">&quot;gray70&quot;</span><span class="p">)</span> <span class="o">+</span>
  geom_text<span class="p">(</span>aes<span class="p">(</span>colour <span class="o">=</span> Variable<span class="p">))</span> <span class="o">+</span>
  ggtitle<span class="p">(</span><span class="s">&quot;MCA plot of variables using R package homals&quot;</span><span class="p">)</span></code></pre></div>

<p><img src="/figs/2012-10-13-MCA-in-R/fig7.png" alt="center"> </p>

</div>

<hr>

<div class="previous_next">
  
    <a href="/how-to/2012/10/03/Dendrograms/" title="Previous post">&larr; previous</a>
  
  &nbsp;&nbsp;
  
    <a href="/opinion/2012/11/07/plstroika/" title="Next post">next &rarr;</a>
  
  <br>
  <p>
  <a class="greenbutton" href="/blog/archive/" title="an archive of all posts">See all posts</a>
  </p>
</div>
    </div>

  </body>
</html>
