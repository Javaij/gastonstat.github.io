<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  
  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Graphs from Dendrograms &middot; Gaston Sanchez
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/hyde.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-144-precomposed.png">
                                 <link rel="shortcut icon" href="/public/favicon.ico">
  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body>

    <div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <h1>
        <a href="/">
          Gaston Sanchez
        </a>
      </h1>
      <p class="lead"></p>
    </div>

    <nav class="sidebar-nav">
      <a class="sidebar-nav-item" href="/">Home</a>

      

      
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
            <a class="sidebar-nav-item" href="/blog/">Blog</a>
          
        
      
        
          
        
      
        
          
        
      
        
          
            <a class="sidebar-nav-item" href="/about/">About</a>
          
        
      
        
          
            <a class="sidebar-nav-item" href="/software/">Software</a>
          
        
      
        
          
            <a class="sidebar-nav-item" href="/teaching/">Teaching</a>
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      

      <a class="sidebar-nav-item" href="https://github.com/gastonstat" target="_blank">GitHub</a>
    </nav>

    <!-- <p><small>All contents under <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">(CC) BY-NC-SA</a> license, unless otherwise noted</small></p>
  -->
  </div>
</div>


    <div class="content container">
      <div class="post">
  <h1 class="post-title">Graphs from Dendrograms</h1>
  <span class="post-date">29 Jun 2014</span>
  <p>R has various functions (and packages) for working with both hierarchical clustering 
dendrograms and graphs. The problem is that there&#39;s almost no information on how 
convert a dendrogram into a graph. </p>

<!--more-->

<p><img src="/images/blog/dendro2graph.png" alt=""></p>

<hr/>

<h3>Trees and Graphs</h3>

<p>For one of my visualization projects I was faced with the following question: 
<strong>How to obtain a graph structure from a dendrogram structure?</strong> As simple as this 
question may seem, it took me a couple of days to find out a satisfactory answer.</p>

<p>Recall that a dendrogram is a just tree diagram used to display the arrangement of the 
clusters produced by hierarchical clustering. Interestingly, we can think of a 
dendrogram as a graph with a tree structure. The leafs of the 
dendrogram and the merged nodes can be seen as the graph nodes. In turn, the 
branches of the dendrogram can be regarded as the graph edges. </p>

<hr/>

<h3>Hierarchical Clustering Dendrogram</h3>

<p>Let&#39;s start by generating a hierarchical clustering with <code>hclust()</code>. We&#39;ll 
use the data <code>USArrests</code> for demo purposes:</p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># distance matrix </span>
dist_usarrests <span class="o">=</span> dist<span class="p">(</span>USArrests<span class="p">)</span>

<span class="c1"># hierarchical clustering analysis</span>
clus_usarrests <span class="o">=</span> hclust<span class="p">(</span>dist_usarrests<span class="p">,</span> method <span class="o">=</span> <span class="s">&quot;ward.D&quot;</span><span class="p">)</span>

<span class="c1"># plot dendrogram</span>
plot<span class="p">(</span>clus_usarrests<span class="p">,</span> hang <span class="o">=</span> <span class="m">-1</span><span class="p">)</span></code></pre></div>

<p><img src="/images/blog/usarrests_dendrogram.png" alt=""></p>

<p>Although <code>&quot;hclust&quot;</code> provides information about the merged nodes, it doesn&#39;t provide 
all the necessary elements to build a graph. To do this, we need to use 
the function <code>as.phylo()</code> from the R package <code>&quot;ape&quot;</code>. The good news 
about a <code>&quot;phylo&quot;</code> object is that it contains all the tree edges needed 
to build a graph.</p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># library ape</span>
<span class="kn">library</span><span class="p">(</span>ape<span class="p">)</span>

<span class="c1"># convert &#39;hclust&#39; to &#39;phylo&#39; object</span>
phylo_tree <span class="o">=</span> as.phylo<span class="p">(</span>clus_usarrests<span class="p">)</span>

<span class="c1"># get edges</span>
graph_edges <span class="o">=</span> phylo_tree<span class="o">$</span>edge</code></pre></div>

<hr/>

<h3>Graph</h3>

<p>Once we have the edges we can build a graph using the function <code>graph.edgelist()</code> 
from the package <code>&quot;igraph&quot;</code>.</p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># library igraph</span>
<span class="kn">library</span><span class="p">(</span>igraph<span class="p">)</span>

<span class="c1"># get graph from edge list</span>
graph_net <span class="o">=</span> graph.edgelist<span class="p">(</span>graph_edges<span class="p">)</span>

<span class="c1"># plot graph</span>
plot<span class="p">(</span>graph_net<span class="p">)</span></code></pre></div>

<p><img src="/images/blog/dendro_graph.png" alt=""></p>

<p>The previous plot is kind of messy but the graph has exactly what we want: it has all the 
leafs, nodes and edges from the dendrogram.</p>

<p>Finally, we can play with the different graph layouts to get a set of x-y 
coordinates. For instance, we can use the <code>layout.auto()</code> function to get 
nodes nicely spread. Having the layout coordinates we can plot a graph with 
a tree structure using some R plotting tools:</p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># extract layout (x-y coords)</span>
graph_layout <span class="o">=</span> layout.auto<span class="p">(</span>graph_net<span class="p">)</span>

<span class="c1"># number of observations</span>
nobs <span class="o">=</span> <span class="kp">nrow</span><span class="p">(</span>USArrests<span class="p">)</span>

<span class="c1"># start plot</span>
plot<span class="p">(</span>graph_layout<span class="p">[,</span><span class="m">1</span><span class="p">],</span> graph_layout<span class="p">[,</span><span class="m">2</span><span class="p">],</span> type <span class="o">=</span> <span class="s">&quot;n&quot;</span><span class="p">,</span> axes <span class="o">=</span> <span class="kc">FALSE</span><span class="p">,</span>
     xlab <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">,</span> ylab <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="c1"># draw tree branches</span>
segments<span class="p">(</span>
  x0 <span class="o">=</span> graph_layout<span class="p">[</span>graph_edges<span class="p">[,</span><span class="m">1</span><span class="p">],</span><span class="m">1</span><span class="p">],</span> 
  y0 <span class="o">=</span> graph_layout<span class="p">[</span>graph_edges<span class="p">[,</span><span class="m">1</span><span class="p">],</span><span class="m">2</span><span class="p">],</span>
  x1 <span class="o">=</span> graph_layout<span class="p">[</span>graph_edges<span class="p">[,</span><span class="m">2</span><span class="p">],</span><span class="m">1</span><span class="p">],</span>
  y1 <span class="o">=</span> graph_layout<span class="p">[</span>graph_edges<span class="p">[,</span><span class="m">2</span><span class="p">],</span><span class="m">2</span><span class="p">],</span>
  col <span class="o">=</span> <span class="s">&quot;#dcdcdc55&quot;</span><span class="p">,</span> lwd <span class="o">=</span> <span class="m">3.5</span>
<span class="p">)</span>
<span class="c1"># add labels</span>
text<span class="p">(</span>graph_layout<span class="p">[</span><span class="m">1</span><span class="o">:</span>nobs<span class="p">,</span><span class="m">1</span><span class="p">],</span> graph_layout<span class="p">[</span><span class="m">1</span><span class="o">:</span>nobs<span class="p">,</span><span class="m">2</span><span class="p">],</span>
     phylo_tree<span class="o">$</span>tip.label<span class="p">,</span> cex <span class="o">=</span> <span class="m">1</span><span class="p">,</span> xpd <span class="o">=</span> <span class="kc">TRUE</span><span class="p">,</span> font <span class="o">=</span> <span class="m">1</span><span class="p">)</span></code></pre></div>

<p><img src="/images/blog/dendro_tree_graph.png" alt=""></p>

<p>If you&#39;re interested in getting a pretty tree graph check the 
<a href="/blog/resources/2014/07/05/Pretty-tree-graph.html">next post</a>.</p>

</div>

<hr>

<div class="previous_next">
  
    <a href="/resources/2014/05/12/Web-data/" title="Previous post">&larr; previous</a>
  
  &nbsp;&nbsp;
  
    <a href="/resources/2014/07/05/Pretty-tree-graph/" title="Next post">next &rarr;</a>
  
  <br>
  <p>
  <a class="greenbutton" href="/blog/archive/" title="an archive of all posts">See all posts</a>
  </p>
</div>
    </div>

  </body>
</html>
