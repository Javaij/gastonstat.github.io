<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  
  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      6 ways of mean-centering data in R &middot; Gaston Sanchez
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/hyde.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-144-precomposed.png">
                                 <link rel="shortcut icon" href="/public/favicon.ico">
  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body>

    <div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <h1>
        <a href="/">
          Gaston Sanchez
        </a>
      </h1>
      <p class="lead"></p>
    </div>

    <nav class="sidebar-nav">
      <a class="sidebar-nav-item" href="/">Home</a>

      

      
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
            <a class="sidebar-nav-item" href="/blog/">Blog</a>
          
        
      
        
          
        
      
        
          
        
      
        
          
            <a class="sidebar-nav-item" href="/about/">About</a>
          
        
      
        
          
            <a class="sidebar-nav-item" href="/software/">Software</a>
          
        
      
        
          
            <a class="sidebar-nav-item" href="/teaching/">Teaching</a>
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      

      <a class="sidebar-nav-item" href="https://github.com/gastonstat" target="_blank">GitHub</a>
    </nav>

    <!-- <p><small>All contents under <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">(CC) BY-NC-SA</a> license, unless otherwise noted</small></p>
  -->
  </div>
</div>


    <div class="content container">
      <div class="post">
  <h1 class="post-title">6 ways of mean-centering data in R</h1>
  <span class="post-date">15 Jan 2014</span>
  <p>One of the most frequent operations in multivariate data analysis is the so-called <strong>mean-centering</strong>. In this post, I&#39;ll show you six different ways to mean-center your data in R.</p>

<!--more-->

<p><img class="centered" src="/images/blog/mean_center.png" /></p>

<h2>Mean-centering</h2>

<p>Prior to the application of many multivariate methods, data are often pre-processed. This pre-processing involves transforming the data into a suitable form for the analysis. Among the different pre-treatment procedures, one of the most common operations is the well known <em>mean-centering</em>. </p>

<p>Mean-centering involves the subtraction of the variable averages from the data. Since multivariate data is typically handled in table format (i.e. matrix) with columns as variables, mean-centering is often referred to as <em>column centering</em>.</p>

<p>What we do with mean-centering is to calculate the average value of each variable and then subtract it from the data. This implies that each column will be transformed in such a way that the resulting variable will have a zero mean.</p>

<h3>Algebraic standpoint</h3>

<p>Algebraically, data-centering can be seen as a transformation. This transformation is done using what we could name as a <em>matrix-centering operator</em> denoted by \( H \)</p>

<p>$$ H = (I_{n} - 1 1&#39;) $$</p>

<p>where \( I \) is the identity matrix of size \( n \), \( 1 \) is a vector of ones of length \(n\), and \( n \) is the number of rows in the data \(X\). If we premultiply \(X\) by \(H\) we get the centered matrix \(X_c\):</p>

<p>$$ X_c = H X $$</p>

<p>Equivalently, if we denote by \( \bar{x} \) the vector of column-averages, the mean-centered matrix can be calculated as:</p>

<p>$$ X_c = X - 1 \bar{x}&#39; $$</p>

<p>From a geometric point of view, data-centering is just a traslation or repositioning of the coordinate system. In other words, the mean-centering procedure corresponds to moving the origin of the coordinate system to coincide with the average point.</p>

<h2>Mean-cenetring in R</h2>

<p>Data can be mean-centered in R in several ways, and you can even write your own mean-centering function. I&#39;ll discuss six different ways to do it. More interestingly, we&#39;ll compare those six options to see which one is the fastest.</p>

<p>For illustration purposes we&#39;ll use the following random small dataset:</p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># small dataset</span>
<span class="kp">set.seed</span><span class="p">(</span><span class="m">212</span><span class="p">)</span>
Data <span class="o">=</span> <span class="kt">matrix</span><span class="p">(</span>rnorm<span class="p">(</span><span class="m">15</span><span class="p">),</span> <span class="m">5</span><span class="p">,</span> <span class="m">3</span><span class="p">)</span>

Data</code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">##         [,1]    [,2]    [,3]
## [1,] -0.2392  0.1545  0.1503
## [2,]  0.6769  1.0369  0.5097
## [3,] -2.4403 -0.7796 -0.7733
## [4,]  1.2409  0.6213  1.8757
## [5,] -0.3265  0.2994  0.7883</code></pre></div>

<h3>Using the scale function</h3>

<p>Perhaps the most simple, quick and direct way to mean-center your data is by using the function <code>scale()</code>. By default, this function will standardize the data (mean zero, unit variance). To indicate that we just want to subtract the mean, we need to turn off the argument <code>scale = FALSE</code>.</p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># centering with &#39;scale()&#39;</span>
center_scale <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>x<span class="p">)</span> <span class="p">{</span>
    <span class="kp">scale</span><span class="p">(</span>x<span class="p">,</span> scale <span class="o">=</span> <span class="kc">FALSE</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1"># apply it</span>
center_scale<span class="p">(</span>Data<span class="p">)</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">##          [,1]     [,2]       [,3]
## [1,] -0.02153 -0.11200 -0.3597876
## [2,]  0.89458  0.77038 -0.0004599
## [3,] -2.22270 -1.04610 -1.2834512
## [4,]  1.45853  0.35477  1.3655295
## [5,] -0.10887  0.03294  0.2781693
## attr(,&quot;scaled:center&quot;)
## [1] -0.2176  0.2665  0.5101</code></pre></div>

<h3>Using the apply function</h3>

<p>Center can be done with the <code>apply()</code> function. In this case, the idea is to remove the mean on each column. This is done by declaring a function (inside <code>apply()</code>) that performs the mean-centering operation:</p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># center with &#39;apply()&#39;</span>
center_apply <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>x<span class="p">)</span> <span class="p">{</span>
    <span class="kp">apply</span><span class="p">(</span>x<span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="kr">function</span><span class="p">(</span>y<span class="p">)</span> y <span class="o">-</span> <span class="kp">mean</span><span class="p">(</span>y<span class="p">))</span>
<span class="p">}</span>

<span class="c1"># apply it</span>
center_apply<span class="p">(</span>Data<span class="p">)</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">##          [,1]     [,2]       [,3]
## [1,] -0.02153 -0.11200 -0.3597876
## [2,]  0.89458  0.77038 -0.0004599
## [3,] -2.22270 -1.04610 -1.2834512
## [4,]  1.45853  0.35477  1.3655295
## [5,] -0.10887  0.03294  0.2781693</code></pre></div>

<h3>Using the sweep function</h3>

<p>Another interesting option to mean-center our data is by using the function <code>sweep()</code>. This function has some similarities with <code>apply()</code>. If you give <code>sweep()</code> a value (i.e. a summary statistic) and a function, it will sweep it out on the indicated margin (either by rows or by columns). In our case, the statistic to sweep out by columns is the mean of every variable.</p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># center with &#39;sweep()&#39;</span>
center_sweep <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>x<span class="p">,</span> row.w <span class="o">=</span> <span class="kp">rep</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="kp">nrow</span><span class="p">(</span>x<span class="p">))</span><span class="o">/</span><span class="kp">nrow</span><span class="p">(</span>x<span class="p">))</span> <span class="p">{</span>
    get_average <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>v<span class="p">)</span> <span class="kp">sum</span><span class="p">(</span>v <span class="o">*</span> row.w<span class="p">)</span><span class="o">/</span><span class="kp">sum</span><span class="p">(</span>row.w<span class="p">)</span>
    average <span class="o">&lt;-</span> <span class="kp">apply</span><span class="p">(</span>x<span class="p">,</span> <span class="m">2</span><span class="p">,</span> get_average<span class="p">)</span>
    <span class="kp">sweep</span><span class="p">(</span>x<span class="p">,</span> <span class="m">2</span><span class="p">,</span> average<span class="p">)</span>
<span class="p">}</span>

<span class="c1"># apply it</span>
center_sweep<span class="p">(</span>Data<span class="p">)</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">##          [,1]     [,2]       [,3]
## [1,] -0.02153 -0.11200 -0.3597876
## [2,]  0.89458  0.77038 -0.0004599
## [3,] -2.22270 -1.04610 -1.2834512
## [4,]  1.45853  0.35477  1.3655295
## [5,] -0.10887  0.03294  0.2781693</code></pre></div>

<h3>Using the colMeans function</h3>

<p>Other function that we can take advantage of <code>colMeans()</code>. With this function we can calculate the average value of each column; then we can construct a matrix with the averages, which will be subtracted from the data:</p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># center with &#39;colMeans()&#39;</span>
center_colmeans <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>x<span class="p">)</span> <span class="p">{</span>
    xcenter <span class="o">=</span> <span class="kp">colMeans</span><span class="p">(</span>x<span class="p">)</span>
    x <span class="o">-</span> <span class="kp">rep</span><span class="p">(</span>xcenter<span class="p">,</span> <span class="kp">rep.int</span><span class="p">(</span><span class="kp">nrow</span><span class="p">(</span>x<span class="p">),</span> <span class="kp">ncol</span><span class="p">(</span>x<span class="p">)))</span>
<span class="p">}</span>

<span class="c1"># apply it</span>
center_colmeans<span class="p">(</span>Data<span class="p">)</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">##          [,1]     [,2]       [,3]
## [1,] -0.02153 -0.11200 -0.3597876
## [2,]  0.89458  0.77038 -0.0004599
## [3,] -2.22270 -1.04610 -1.2834512
## [4,]  1.45853  0.35477  1.3655295
## [5,] -0.10887  0.03294  0.2781693</code></pre></div>

<h3>Using a center-operator</h3>

<p>We can create the mean-center operator \(H\) and use it to premultiply the data matrix like so:</p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># center matrix operator</span>
center_operator <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>x<span class="p">)</span> <span class="p">{</span>
    n <span class="o">=</span> <span class="kp">nrow</span><span class="p">(</span>x<span class="p">)</span>
    ones <span class="o">=</span> <span class="kp">rep</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> n<span class="p">)</span>
    H <span class="o">=</span> <span class="kp">diag</span><span class="p">(</span>n<span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="m">1</span><span class="o">/</span>n<span class="p">)</span> <span class="o">*</span> <span class="p">(</span>ones <span class="o">%*%</span> <span class="kp">t</span><span class="p">(</span>ones<span class="p">))</span>
    H <span class="o">%*%</span> x
<span class="p">}</span>

<span class="c1"># apply it</span>
center_operator<span class="p">(</span>Data<span class="p">)</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">##          [,1]     [,2]       [,3]
## [1,] -0.02153 -0.11200 -0.3597876
## [2,]  0.89458  0.77038 -0.0004599
## [3,] -2.22270 -1.04610 -1.2834512
## [4,]  1.45853  0.35477  1.3655295
## [5,] -0.10887  0.03294  0.2781693</code></pre></div>

<h3>Using mean subtraction</h3>

<p>Finally, we can write a function that implements the algebraic alternative in which the mean-vector is used to create the mean-matrix that is subtracted from the data:</p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># mean subtraction</span>
center_mean <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>x<span class="p">)</span> <span class="p">{</span>
    ones <span class="o">=</span> <span class="kp">rep</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="kp">nrow</span><span class="p">(</span>x<span class="p">))</span>
    x_mean <span class="o">=</span> ones <span class="o">%*%</span> <span class="kp">t</span><span class="p">(</span><span class="kp">colMeans</span><span class="p">(</span>x<span class="p">))</span>
    x <span class="o">-</span> x_mean
<span class="p">}</span>

<span class="c1"># apply it</span>
center_mean<span class="p">(</span>Data<span class="p">)</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">##          [,1]     [,2]       [,3]
## [1,] -0.02153 -0.11200 -0.3597876
## [2,]  0.89458  0.77038 -0.0004599
## [3,] -2.22270 -1.04610 -1.2834512
## [4,]  1.45853  0.35477  1.3655295
## [5,] -0.10887  0.03294  0.2781693</code></pre></div>

<h3>What option to use?</h3>

<p>So far we&#39;ve seen six different ways in which we can mean-center a matrix. But what option is the more efficient (computationally)? To get an answer nothing better than make a small contest to see which of our 6 options is the fastest (and which one the slowest):</p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># fake data</span>
X <span class="o">=</span> <span class="kt">matrix</span><span class="p">(</span>runif<span class="p">(</span><span class="m">2000</span><span class="p">),</span> <span class="m">100</span><span class="p">,</span> <span class="m">20</span><span class="p">)</span>

<span class="c1"># test them</span>
<span class="kp">system.time</span><span class="p">(</span><span class="kp">replicate</span><span class="p">(</span><span class="m">500</span><span class="p">,</span> center_scale<span class="p">(</span>X<span class="p">)))</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">##    user  system elapsed 
##   0.106   0.004   0.110</code></pre></div>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="kp">system.time</span><span class="p">(</span><span class="kp">replicate</span><span class="p">(</span><span class="m">500</span><span class="p">,</span> center_apply<span class="p">(</span>X<span class="p">)))</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">##    user  system elapsed 
##   0.239   0.009   0.248</code></pre></div>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="kp">system.time</span><span class="p">(</span><span class="kp">replicate</span><span class="p">(</span><span class="m">500</span><span class="p">,</span> center_sweep<span class="p">(</span>X<span class="p">)))</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">##    user  system elapsed 
##   0.222   0.010   0.232</code></pre></div>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="kp">system.time</span><span class="p">(</span><span class="kp">replicate</span><span class="p">(</span><span class="m">500</span><span class="p">,</span> center_colmeans<span class="p">(</span>X<span class="p">)))</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">##    user  system elapsed 
##   0.060   0.000   0.061</code></pre></div>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="kp">system.time</span><span class="p">(</span><span class="kp">replicate</span><span class="p">(</span><span class="m">500</span><span class="p">,</span> center_operator<span class="p">(</span>X<span class="p">)))</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">##    user  system elapsed 
##   0.209   0.037   0.244</code></pre></div>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="kp">system.time</span><span class="p">(</span><span class="kp">replicate</span><span class="p">(</span><span class="m">500</span><span class="p">,</span> center_mean<span class="p">(</span>X<span class="p">)))</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">##    user  system elapsed 
##   0.066   0.001   0.067</code></pre></div>

<p>And the winner is ... <code>center_colmeans()</code></p>

</div>

<hr>

<div class="previous_next">
  
    <a href="/opinion/2013/12/29/moving-to-jekyll/" title="Previous post">&larr; previous</a>
  
  &nbsp;&nbsp;
  
    <a href="/opinion/2014/02/16/Mathjax-with-jekyll/" title="Next post">next &rarr;</a>
  
  <br>
  <p>
  <a class="greenbutton" href="/blog/archive/" title="an archive of all posts">See all posts</a>
  </p>
</div>
    </div>

  </body>
</html>
