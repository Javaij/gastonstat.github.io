<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  
  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Pretty Tree Graph &middot; Gaston Sanchez
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/hyde.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-144-precomposed.png">
                                 <link rel="shortcut icon" href="/public/favicon.ico">
  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body>

    <div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <h1>
        <a href="/">
          Gaston Sanchez
        </a>
      </h1>
      <p class="lead"></p>
    </div>

    <nav class="sidebar-nav">
      <a class="sidebar-nav-item" href="/">Home</a>

      

      
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
            <a class="sidebar-nav-item" href="/blog/">Blog</a>
          
        
      
        
          
        
      
        
          
        
      
        
          
            <a class="sidebar-nav-item" href="/about/">About</a>
          
        
      
        
          
            <a class="sidebar-nav-item" href="/software/">Software</a>
          
        
      
        
          
            <a class="sidebar-nav-item" href="/teaching/">Teaching</a>
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      

      <a class="sidebar-nav-item" href="https://github.com/gastonstat" target="_blank">GitHub</a>
    </nav>

    <!-- <p><small>All contents under <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">(CC) BY-NC-SA</a> license, unless otherwise noted</small></p>
  -->
  </div>
</div>


    <div class="content container">
      <div class="post">
  <h1 class="post-title">Pretty Tree Graph</h1>
  <span class="post-date">05 Jul 2014</span>
  <p>In this post I&#39;m sharing the code snippet in R I used to get a pretty graph 
to visualize dendrograms and clusters in an alternative way. </p>

<!--more-->

<p><img src="/images/blog/pretty_tree.png" alt=""></p>

<hr/>

<h2>Recipe</h2>

<p>The general recipe consists of the following steps:</p>

<ol>
<li>Obtain a distance matrix from your data set with <code>dist()</code></li>
<li>Perform a hierarchical clustering analysis with <code>hclust()</code></li>
<li>Examine the dendrogram to determine the number of clusters</li>
<li>Cut the dendrogram to obtain clusters with <code>cutree()</code></li>
<li>Convert cluster structure into a <code>&quot;phylo&quot;</code> object with <code>as.phylo()</code></li>
<li>Use the tree nodes from the <code>&quot;phylo&quot;</code> object to obtain a graph with <code>graph.edgelist()</code></li>
<li>Obtain a graph layout, in this case with <code>layout.auto()</code></li>
<li>Plot the data with the x-y coordinates from the graph layout!</li>
</ol>

<hr/>

<h2>Example with data &quot;USArrests&quot;</h2>

<p>For this example I&#39;m going to use the data set <code>USArrests</code> that comes with R. 
The idea is to get a dendrogram from a hierarchical clustering analysis. For 
illustration purposes I&#39;m going to cut the dendrogram in 4 clusters.</p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># distance matrix </span>
dist_usarrests <span class="o">=</span> dist<span class="p">(</span>USArrests<span class="p">)</span>

<span class="c1"># hierarchical clustering analysis</span>
clus_usarrests <span class="o">=</span> hclust<span class="p">(</span>dist_usarrests<span class="p">,</span> method <span class="o">=</span> <span class="s">&quot;ward.D&quot;</span><span class="p">)</span>

<span class="c1"># plot dendrogram</span>
plot<span class="p">(</span>clus_usarrests<span class="p">,</span> hang <span class="o">=</span> <span class="m">-1</span><span class="p">)</span></code></pre></div>

<p><img src="/images/blog/usarrests_dendrogram.png" alt=""></p>

<hr/>

<h2>Code in R: Pretty Tree Graph</h2>

<p>Once we have the &quot;not very outstanding&quot; dendrogram, we can do some data wrangling 
in order to obtain a better layout to display the obtained clusters in a very 
appealing visual way. Here&#39;s the code snippet in R (feel free to adapt it for your 
own visualizations).</p>

<div class="highlight"><pre><code class="language-r" data-lang="r">pretty_tree <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>dataset<span class="p">,</span> num_clusters <span class="o">=</span> <span class="m">2</span><span class="p">,</span> 
    dist_method <span class="o">=</span> <span class="s">&quot;euclidean&quot;</span><span class="p">,</span> clus_method <span class="o">=</span> <span class="s">&quot;ward.D&quot;</span><span class="p">)</span> 
<span class="p">{</span>
  <span class="c1"># required packages</span>
  <span class="kn">require</span><span class="p">(</span>ape<span class="p">)</span>     <span class="c1"># for phylo trees</span>
  <span class="kn">require</span><span class="p">(</span>igraph<span class="p">)</span>  <span class="c1"># for graphs</span>
  
  <span class="c1"># distance matrix</span>
  dist_data <span class="o">=</span> dist<span class="p">(</span>dataset<span class="p">,</span> method <span class="o">=</span> dist_method<span class="p">)</span>
  <span class="c1"># hierarchical clustering</span>
  hcluster <span class="o">=</span> hclust<span class="p">(</span>dist_data<span class="p">,</span> method <span class="o">=</span> clus_method<span class="p">)</span>
  <span class="c1"># cut dendrogram in given number of clusters</span>
  clusters <span class="o">=</span> cutree<span class="p">(</span>tree <span class="o">=</span> hcluster<span class="p">,</span> k <span class="o">=</span> num_clusters<span class="p">)</span>
  
  <span class="c1"># convert to phylo object</span>
  phylo_tree <span class="o">=</span> as.phylo<span class="p">(</span>hcluster<span class="p">)</span>
  <span class="c1"># get edges</span>
  graph_edges <span class="o">=</span> phylo_tree<span class="o">$</span>edge
  <span class="c1"># convert to graph</span>
  graph_net <span class="o">=</span> graph.edgelist<span class="p">(</span>graph_edges<span class="p">)</span>
  <span class="c1"># extract layout (x-y coords)</span>
  graph_layout <span class="o">=</span> layout.auto<span class="p">(</span>graph_net<span class="p">)</span>
  
  <span class="c1"># colors like default ggplot2</span>
  ggcolors <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>n<span class="p">,</span> alfa<span class="p">)</span> <span class="p">{</span>
    hues <span class="o">=</span> <span class="kp">seq</span><span class="p">(</span><span class="m">15</span><span class="p">,</span> <span class="m">375</span><span class="p">,</span> length <span class="o">=</span> n <span class="o">+</span> <span class="m">1</span><span class="p">)</span>
    hcl<span class="p">(</span>h <span class="o">=</span> hues<span class="p">,</span> l <span class="o">=</span> <span class="m">65</span><span class="p">,</span> <span class="kt">c</span> <span class="o">=</span> <span class="m">100</span><span class="p">,</span> alpha <span class="o">=</span> alfa<span class="p">)[</span><span class="m">1</span><span class="o">:</span>n<span class="p">]</span>
  <span class="p">}</span>
  
  <span class="c1"># colors of labels and points</span>
  txt_pal <span class="o">=</span> ggcolors<span class="p">(</span>num_clusters<span class="p">)</span>
  pch_pal <span class="o">=</span> <span class="kp">paste</span><span class="p">(</span>txt_pal<span class="p">,</span> <span class="s">&quot;55&quot;</span><span class="p">,</span> sep<span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>
  txt_col <span class="o">=</span> txt_pal<span class="p">[</span>clusters<span class="p">]</span>
  pch_col <span class="o">=</span> pch_pal<span class="p">[</span>clusters<span class="p">]</span>

  <span class="c1"># additional params</span>
  nobs <span class="o">=</span> <span class="kp">length</span><span class="p">(</span>clusters<span class="p">)</span>
  nedges <span class="o">=</span> <span class="kp">nrow</span><span class="p">(</span>graph_edges<span class="p">)</span>
  
  <span class="c1"># start plot</span>
  plot<span class="p">(</span>graph_layout<span class="p">[,</span><span class="m">1</span><span class="p">],</span> graph_layout<span class="p">[,</span><span class="m">2</span><span class="p">],</span> type <span class="o">=</span> <span class="s">&quot;n&quot;</span><span class="p">,</span> axes <span class="o">=</span> <span class="kc">FALSE</span><span class="p">,</span>
       xlab <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">,</span> ylab <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
  <span class="c1"># draw tree branches</span>
  segments<span class="p">(</span>
    x0 <span class="o">=</span> graph_layout<span class="p">[</span>graph_edges<span class="p">[,</span><span class="m">1</span><span class="p">],</span><span class="m">1</span><span class="p">],</span> 
    y0 <span class="o">=</span> graph_layout<span class="p">[</span>graph_edges<span class="p">[,</span><span class="m">1</span><span class="p">],</span><span class="m">2</span><span class="p">],</span>
    x1 <span class="o">=</span> graph_layout<span class="p">[</span>graph_edges<span class="p">[,</span><span class="m">2</span><span class="p">],</span><span class="m">1</span><span class="p">],</span>
    y1 <span class="o">=</span> graph_layout<span class="p">[</span>graph_edges<span class="p">[,</span><span class="m">2</span><span class="p">],</span><span class="m">2</span><span class="p">],</span>
    col <span class="o">=</span> <span class="s">&quot;#dcdcdc55&quot;</span><span class="p">,</span> lwd <span class="o">=</span> <span class="m">3.5</span>
  <span class="p">)</span>
  <span class="c1"># add tree leafs</span>
  points<span class="p">(</span>graph_layout<span class="p">[</span><span class="m">1</span><span class="o">:</span>nobs<span class="p">,</span><span class="m">1</span><span class="p">],</span> graph_layout<span class="p">[</span><span class="m">1</span><span class="o">:</span>nobs<span class="p">,</span><span class="m">2</span><span class="p">],</span> col <span class="o">=</span> pch_col<span class="p">,</span> 
         pch <span class="o">=</span> <span class="m">19</span><span class="p">,</span> cex <span class="o">=</span> <span class="m">2</span><span class="p">)</span>
  <span class="c1"># add empty nodes</span>
  points<span class="p">(</span>graph_layout<span class="p">[(</span>nobs<span class="m">+1</span><span class="p">)</span><span class="o">:</span>nedges<span class="p">,</span><span class="m">1</span><span class="p">],</span> graph_layout<span class="p">[(</span>nobs<span class="m">+1</span><span class="p">)</span><span class="o">:</span>nedges<span class="p">,</span><span class="m">2</span><span class="p">],</span> 
         col <span class="o">=</span> <span class="s">&quot;gray90&quot;</span><span class="p">,</span> pch <span class="o">=</span> <span class="m">19</span><span class="p">,</span> cex <span class="o">=</span> <span class="m">0.5</span><span class="p">)</span>
  <span class="c1"># add node labels</span>
  text<span class="p">(</span>graph_layout<span class="p">[</span><span class="m">1</span><span class="o">:</span>nobs<span class="p">,</span><span class="m">1</span><span class="p">],</span> graph_layout<span class="p">[</span><span class="m">1</span><span class="o">:</span>nobs<span class="p">,</span><span class="m">2</span><span class="p">],</span> col <span class="o">=</span> txt_col<span class="p">,</span>
       phylo_tree<span class="o">$</span>tip.label<span class="p">,</span> cex <span class="o">=</span> <span class="m">1.5</span><span class="p">,</span> xpd <span class="o">=</span> <span class="kc">TRUE</span><span class="p">,</span> font <span class="o">=</span> <span class="m">1</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1"># plot</span>
pretty_tree<span class="p">(</span>USArrests<span class="p">,</span> num_clusters <span class="o">=</span> <span class="m">4</span><span class="p">)</span></code></pre></div>

<p><img src="/images/blog/pretty_tree.png" alt=""></p>

</div>

<hr>

<div class="previous_next">
  
    <a href="/how-to/2014/06/29/Graph-from-dendrogram/" title="Previous post">&larr; previous</a>
  
  &nbsp;&nbsp;
  
    <a href="/how-to/2014/08/16/Density-Curves/" title="Next post">next &rarr;</a>
  
  <br>
  <p>
  <a class="greenbutton" href="/blog/archive/" title="an archive of all posts">See all posts</a>
  </p>
</div>
    </div>

  </body>
</html>
