<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  
  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Arc Diagrams in R: Les Miserables &middot; Gaston Sanchez
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/hyde.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-144-precomposed.png">
                                 <link rel="shortcut icon" href="/public/favicon.ico">
  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body>

    <div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <h1>
        <a href="/">
          Gaston Sanchez
        </a>
      </h1>
      <p class="lead"></p>
    </div>

    <nav class="sidebar-nav">
      <a class="sidebar-nav-item" href="/">Home</a>

      

      
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
            <a class="sidebar-nav-item" href="/blog/">Blog</a>
          
        
      
        
          
        
      
        
          
        
      
        
          
            <a class="sidebar-nav-item" href="/about/">About</a>
          
        
      
        
          
            <a class="sidebar-nav-item" href="/software/">Software</a>
          
        
      
        
          
            <a class="sidebar-nav-item" href="/teaching/">Teaching</a>
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      

      <a class="sidebar-nav-item" href="https://github.com/gastonstat" target="_blank">GitHub</a>
    </nav>

    <!-- <p><small>All contents under <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">(CC) BY-NC-SA</a> license, unless otherwise noted</small></p>
  -->
  </div>
</div>


    <div class="content container">
      <div class="post">
  <h1 class="post-title">Arc Diagrams in R: Les Miserables</h1>
  <span class="post-date">02 Feb 2013</span>
  <p>In this post we will talk about the R package <code>&quot;arcdiagram&quot;</code> for plotting pretty arc 
diagrams like the one below:</p>

<p><img class="centered" src="/images/blog/pretty_arcdiagram.png" /></p>

<!--more-->

<h3>Arc Diagrams</h3>

<p>An <strong>arc diagram</strong> is a graphical display to visualize graphs or networks in a 
one-dimensional layout. The main idea is to display nodes along a single axis, while 
representing the edges or connections between nodes with arcs. One of the disadvantages 
of arc diagrams is that they may not provide the overall structure of the network as 
effectively as a two-dimensional layout; however, with a good ordering of nodes, better 
visualizations can be achieved making it easy to identify clusters and bridges. Further, 
annotations and multivariate data can easily be displayed alongside nodes.</p>

<h4>Some inspiration</h4>

<p>I got hooked with arc diagrams the first time I saw the famous 
<a title="Similar Diversity" href="http://similardiversity.net/" target="_blank">Similar Diversity</a> 
graphic by Philipp Steinweber and Andreas Koller. I was so captivated with this diagram 
that I eventually made my own attempt to replicate it using the Star Wars movie scripts 
(see this <a href="/got-plot/crunching-data/2013/02/03/Star-Wars-Arc-Diagram/">post</a> and these <a title="star wars arc diagram" href="https://docs.google.com/presentation/d/1m1kRuqTH5lcj1X8TkuvZCoQ7n7dSPZE_OBqkMl3CzM8/pub?start=false&amp;loop=false&amp;delayms=3000" target="_blank">slides</a>).</p>

<h4>Arc Diagram: <em>Les Misérables</em></h4>

<p>Another really cool example of an arc diagram can be found in the 
<a title="protovis arc diagram" href="http://mbostock.github.com/protovis/ex/arc.html" target="_blank">examples&#39; gallery</a> 
of Protovis (by Mike Bostock):</p>

<p><a href="http://mbostock.github.com/protovis/ex/arc-full.html" target="_blank">
<img class="centered" src="/images/protovis.png" title="protovis" />
</a></p>

<p>The diagram above is based on a network representation of character co-occurrence in the 
chapters of Victor Hugo&#39;s classic novel 
<a title="les miserables" href="http://en.wikipedia.org/wiki/Les_Misérables" target="_blank">Les Misérables</a>. 
The original data set is from <em>The Stanford GraphBase: A Platform for Combinatorial Computing</em> 
(by <a title="Donald Knuth" href="http://www-cs-faculty.stanford.edu/~uno/" target="_blank">Donald Knuth</a>). 
The node colors indicate cluster memberships. You can find related files with the 
character co-occurrence network in <a title="protovis" href="http://mbostock.github.com/protovis/" target="_blank">Protovis</a> and <a title="gephi" href="https://gephi.org/" target="_blank">Gephi</a>:</p>

<ul>
<li>Protovis: <a title="miserables.js" href="http://mbostock.github.com/protovis/ex/miserables.js" target="_blank">miserables.js</a> (json format)</li>
<li>Gephi: <a title="gephi miserables" href="http://wiki.gephi.org/index.php/Datasets" target="_blank">lesmiserables.gml</a> (GML format)</li>
</ul>

<h3>Les Misérables Arc in R</h3>

<p>The R package <code>&quot;arcdiagram&quot;</code> has been designed to help you plot pretty arc diagrams 
of graphs in R. You can think of it as a plugin of the package <code>&quot;igraph&quot;</code> (by Gabor 
Csardi and Tamas Nepusz). However, you could also make it work with <code>&quot;network&quot;</code> (by 
Carter Butts <em>et al</em>). </p>

<p><code>&quot;arcdiagram&quot;</code> lives in one of my 
<a title="github arcdiagram" href="https://github.com/gastonstat/arcdiagram" target="_blank">github repositories</a>; 
the complete documentation of the package as well as some basic examples are available at:
<a href="/arcdiagram_introduction.pdf">www.gastonsanchez.com/arcdiagram_introduction.pdf</a></p>

<h4>1) Installation</h4>

<p>To install <code>&quot;arcdiagram&quot;</code> you will need to use the function <code>install_github()</code> 
from the package <code>&quot;devtools&quot;</code> (by Hadley Wickham):</p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># install devtools</span>
install.packages<span class="p">(</span><span class="s">&quot;devtools&quot;</span><span class="p">)</span>

<span class="c1"># load devtools</span>
<span class="kn">library</span><span class="p">(</span>devtools<span class="p">)</span>

<span class="c1"># install arcdiagram</span>
install_github<span class="p">(</span><span class="s">&#39;arcdiagram&#39;</span><span class="p">,</span> username <span class="o">=</span> <span class="s">&#39;gastonstat&#39;</span><span class="p">)</span>

<span class="c1"># load arcdiagram</span>
<span class="kn">library</span><span class="p">(</span>arcdiagram<span class="p">)</span></code></pre></div>

<h4>2) Download the <em>gml</em> file <code>lesmiserables.txt</code></h4>

<p>After installing <code>&quot;arcdiagram&quot;</code>, the next step is to download the data file 
<code>lesmiserables.txt</code> that contains the graph in 
<a title="GML format" href="https://gephi.org/users/supported-graph-formats/gml-format/" target="_blank">GML</a> 
format. Download <a href="/data/lesmiserables.txt">lesmiserables.txt</a></p>

<p>In my case I downloaded the file in my directory: <code>&quot;/Users/gaston/lesmiserables.txt&quot;</code> 
(yours will be different). Once you have the graph file, you can import it in R with 
the function <code>read.graph()</code> like so:</p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># location of &#39;gml&#39; file</span>
mis_file <span class="o">=</span> <span class="s">&quot;/Users/gaston/lesmiserables.txt&quot;</span>

<span class="c1"># read &#39;gml&#39; file</span>
mis_graph <span class="o">=</span> read.graph<span class="p">(</span>mis_file<span class="p">,</span> format <span class="o">=</span> <span class="s">&quot;gml&quot;</span><span class="p">)</span></code></pre></div>

<h4>3) Extracting graph attributes</h4>

<p>The main function in <code>&quot;arcdiagram&quot;</code> is the <code>arcplot()</code> function. This function 
requires an <code>edgelist</code> as its primary ingredient (an edge list is just a two column 
matrix that gives the list of edges for a graph). The rest of its arguments are a bunch 
of graphical parameters to play with.</p>

<p>Most of the information that we need to reproduce the arc diagram is already contained 
in the gml file as vertex and edge attributes. The trick is to extract the values with 
the functions <code>get.vertex.attribute()</code> and <code>get.edge.attribute()</code>:</p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># get edgelist</span>
edgelist <span class="o">=</span> get.edgelist<span class="p">(</span>mis_graph<span class="p">)</span>

<span class="c1"># get vertex labels</span>
vlabels <span class="o">=</span> get.vertex.attribute<span class="p">(</span>mis_graph<span class="p">,</span> <span class="s">&quot;label&quot;</span><span class="p">)</span>

<span class="c1"># get vertex groups</span>
vgroups <span class="o">=</span> get.vertex.attribute<span class="p">(</span>mis_graph<span class="p">,</span> <span class="s">&quot;group&quot;</span><span class="p">)</span>

<span class="c1"># get vertex fill color</span>
vfill <span class="o">=</span> get.vertex.attribute<span class="p">(</span>mis_graph<span class="p">,</span> <span class="s">&quot;fill&quot;</span><span class="p">)</span>

<span class="c1"># get vertex border color</span>
vborders <span class="o">=</span> get.vertex.attribute<span class="p">(</span>mis_graph<span class="p">,</span> <span class="s">&quot;border&quot;</span><span class="p">)</span>

<span class="c1"># get vertex degree</span>
degrees <span class="o">=</span> degree<span class="p">(</span>mis_graph<span class="p">)</span>

<span class="c1"># get edges value</span>
values <span class="o">=</span> get.edge.attribute<span class="p">(</span>mis_graph<span class="p">,</span> <span class="s">&quot;value&quot;</span><span class="p">)</span></code></pre></div>

<h4>4) Nodes ordering</h4>

<p>We need to get the nodes ordering by using the package <code>&quot;reshape&quot;</code> (by Hadley 
Wickham). The idea is to create a data frame with the following variables: 
<code>vgroups</code>, <code>degrees</code>, <code>vlabels</code>, and a numeric index <code>ind</code> for the nodes. 
We will arrange the data frame in descending order, first by <code>vgroups</code> and then by 
<code>degrees</code>; what we want is the sorted numeric index <code>ind</code>:</p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># load reshape</span>
<span class="kn">library</span><span class="p">(</span>reshape<span class="p">)</span>

<span class="c1"># data frame with vgroups, degree, vlabels and ind</span>
x <span class="o">=</span> <span class="kt">data.frame</span><span class="p">(</span>vgroups<span class="p">,</span> degrees<span class="p">,</span> vlabels<span class="p">,</span> ind <span class="o">=</span> <span class="m">1</span><span class="o">:</span>vcount<span class="p">(</span>mis_graph<span class="p">))</span>

<span class="c1"># arranging by vgroups and degrees</span>
y <span class="o">=</span> arrange<span class="p">(</span>x<span class="p">,</span> desc<span class="p">(</span>vgroups<span class="p">),</span> desc<span class="p">(</span>degrees<span class="p">))</span>

<span class="c1"># get ordering &#39;ind&#39;</span>
new_ord <span class="o">=</span> y<span class="o">$</span>ind</code></pre></div>

<h4>5) Plot arc diagram</h4>

<p>Now that we have all the elements for <code>arcplot()</code> (edgelist, nodes ordering, 
graphical attributes), we are ready to plot the arc diagram. Here&#39;s the code in R:</p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># plot arc diagram</span>
arcplot<span class="p">(</span>edgelist<span class="p">,</span> ordering <span class="o">=</span> new_ord<span class="p">,</span> labels <span class="o">=</span> vlabels<span class="p">,</span> cex.labels <span class="o">=</span> <span class="m">0.8</span><span class="p">,</span>
        show.nodes <span class="o">=</span> <span class="kc">TRUE</span><span class="p">,</span> col.nodes <span class="o">=</span> vborders<span class="p">,</span> bg.nodes <span class="o">=</span> vfill<span class="p">,</span>
        cex.nodes <span class="o">=</span> <span class="kp">log</span><span class="p">(</span>degrees<span class="p">)</span> <span class="o">+</span> <span class="m">0.5</span><span class="p">,</span> pch.nodes <span class="o">=</span> <span class="m">21</span><span class="p">,</span> lwd.nodes <span class="o">=</span> <span class="m">2</span><span class="p">,</span> line <span class="o">=</span> <span class="m">-0.5</span><span class="p">,</span>
        col.arcs <span class="o">=</span> hsv<span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0.2</span><span class="p">,</span> <span class="m">0.25</span><span class="p">),</span> lwd.arcs <span class="o">=</span> <span class="m">1.5</span> <span class="o">*</span> values<span class="p">)</span></code></pre></div>

<p><img class="centered" src="/images/blog/miserables_arcplot.png" /></p>

<p>Happy plotting!</p>

</div>

<hr>

<div class="previous_next">
  
    <a href="/how-to/2013/01/23/MDS-in-R/" title="Previous post">&larr; previous</a>
  
  &nbsp;&nbsp;
  
    <a href="/got-plot/crunching-data/2013/02/03/Star-Wars-Arc-Diagram/" title="Next post">next &rarr;</a>
  
  <br>
  <p>
  <a class="greenbutton" href="/blog/archive/" title="an archive of all posts">See all posts</a>
  </p>
</div>
    </div>

  </body>
</html>
